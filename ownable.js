(()=>{"use strict";var e={969:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RESPONSE_TYPE=t.CALL_TYPE=void 0,t.CALL_TYPE="simple-iframe-rpc-call",t.RESPONSE_TYPE="simple-iframe-rpc-response"},334:(e,t,n)=>{const s=n(969);t.A=class{constructor(e){this.methods=e}send(e,t){Promise.resolve(t).then((t=>this.sendResult(e,t))).catch((t=>this.sendError(e,t)))}sendResult(e,t){const{channel:n,id:r}=e.data,a=e.source||this.fallbackSource,o=e.origin&&"null"!==e.origin?e.origin:"*";a.postMessage({"@rpc":s.RESPONSE_TYPE,channel:n,id:r,result:t},o)}sendError(e,t){const{channel:n,id:r}=e.data,a=e.source||this.fallbackSource,o=e.origin&&"null"!==e.origin?e.origin:"*";a.postMessage({"@rpc":s.RESPONSE_TYPE,channel:n,id:r,error:t},o)}listen(e,t){e.addEventListener("message",(e=>{if("*"!==t&&e.origin!==t||e.data["@rpc"]!==s.CALL_TYPE)return;const{fn:n,args:r}=e.data;if(n in this.methods)try{this.send(e,this.methods[n](...r))}catch(t){this.sendError(e,t)}else this.sendError(e,`RPC method '${n}' is not defined`)}))}}}},t={};function n(s){var r=t[s];if(void 0!==r)return r.exports;var a=t[s]={exports:{}};return e[s](a,a.exports,n),a.exports}n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s={};let r,a;function o(e){return Object.fromEntries(e.map((e=>[e.key,e.value])))}function i(e,t,n,s,r){return new Promise(((o,i)=>{a?(a.addEventListener("message",(t=>{if("err"in t.data)return void i(new Error(`Ownable ${e} failed`,{cause:t.data.err}));const n=t.data.get("result"),s=JSON.parse(n),a=t.data.has("mem")?JSON.parse(t.data.get("mem")).state_dump:r;o({response:s,state:a})}),{once:!0}),a.postMessage({type:e,ownable_id:t,msg:n,info:s,mem:{state_dump:r}})):i(`Unable to ${e}: not initialized`)}))}function c(e,t){return{attributes:o(e.attributes),events:(e.events||[]).map((e=>({type:e.type,attributes:o(e.attributes)}))),data:e.data,state:t}}async function d(e,t){return(await i("query",r,e,{},t)).response}async function u(e,t){const n=await d(e,t);return JSON.parse(atob(n))}n.r(s),new(n(334).A)({init:function(e,t,n){return r=e,new Promise((async(e,s)=>{const r=new Blob([t],{type:"application/javascript"}),o=URL.createObjectURL(r);a=new Worker(o,{type:"module"}),a.onmessage=t=>{e(t.data)},a.onerror=e=>s(e),a.onmessageerror=e=>s(e);const i=n.buffer;a.postMessage(i,[i])}))},instantiate:async function(e,t){const{response:n,state:s}=await i("instantiate",r,e,t);return{attributes:o(n.attributes),state:s}},execute:async function(e,t,n){const{response:s,state:a}=await i("execute",r,e,t,n);return c(s,a)},externalEvent:async function(e,t,n){const s={info:t};console.log("external event call with ",e,s);const{response:a,state:o}=await i("external_event",r,e,s,n);return c(a,o)},query:u,queryRaw:d,refresh:async function(e){const t=await u({get_widget_state:{}},e);document.getElementsByTagName("iframe")[0].contentWindow.postMessage({ownable_id:r,state:t},"*")}}).listen(window,"*"),window.addEventListener("message",(e=>{"null"!==e.origin||"@rpc"in e.data||window.parent.postMessage(e.data,"*")}));var l=self;for(var p in s)l[p]=s[p];s.__esModule&&Object.defineProperty(l,"__esModule",{value:!0})})();
//# sourceMappingURL=ownable.js.map